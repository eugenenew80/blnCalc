<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">

    <changeSet id="calc-eug-1845" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating table: calc_balance_source_lines_f</comment>
        <createTable tableName="calc_balance_source_lines_f" schemaName="apps" remarks="Шаблон для баланса энергоисточника - строки">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="line_num" type="number" remarks="Номер строки">
                <constraints nullable="false"/>
            </column>

            <column name="header_id" type="number" remarks="Идентификатор заголовка">
                <constraints nullable="false"/>
            </column>

            <column name="metering_point_id" type="number" remarks="Идентификатор точки учёта">
                <constraints nullable="false"/>
            </column>

            <column name="param_id" type="number" remarks="Идентификатор параметра">
                <constraints nullable="true"/>
            </column>

            <column name="rate" type="number" remarks="Множитель">
                <constraints nullable="false"/>
            </column>

            <column name="sign" type="varchar2(1)" remarks="Знак">
                <constraints nullable="false"/>
            </column>

            <column name="start_date" type="date" remarks="Действует с">
                <constraints nullable="true"/>
            </column>

            <column name="end_date" type="date" remarks="Действует по">
                <constraints nullable="true"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="calc-eug-1846" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating primary key for table: calc_balance_source_lines_f</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_calc_balance_source_lines_f"
                schemaName="apps"
                tableName="calc_balance_source_lines_f"/>
    </changeSet>

    <changeSet id="calc-eug-1847" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating sequence for table: calc_balance_source_lines_f</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="calc_balance_source_lines_f_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="calc-eug-1848" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_balance_source_lines_f</comment>
        <createIndex indexName="idx_calc_balance_source_lines_f_1"
                     schemaName="apps"
                     tableName="calc_balance_source_lines_f"
                     unique="false">
            <column name="header_id" type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-1849" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_balance_source_lines_f</comment>
        <createIndex indexName="idx_calc_balance_source_lines_f_2"
                     schemaName="apps"
                     tableName="calc_balance_source_lines_f"
                     unique="false">
            <column name="metering_point_id" type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-1850" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_balance_source_lines_f</comment>
        <createIndex indexName="idx_calc_balance_source_lines_f_3"
                     schemaName="apps"
                     tableName="calc_balance_source_lines_f"
                     unique="false">
            <column name="param_id" type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-1851" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_balance_source_lines_f to calc_balance_source_headers</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_balance_source_lines_f"
                baseColumnNames="header_id"
                constraintName="fk_calc_balance_source_lines_f_1"
                deferrable="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="calc_balance_source_headers"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-1852" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_balance_source_lines_f to dict_metering_points</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_balance_source_lines_f"
                baseColumnNames="metering_point_id"
                constraintName="fk_calc_balance_source_lines_f_2"
                deferrable="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_metering_points"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-1853" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_balance_source_lines_f to media_parameters</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_balance_source_lines_f"
                baseColumnNames="param_id"
                constraintName="fk_calc_balance_source_lines_f_3"
                deferrable="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="media_parameters"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-1854" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_balance_source_lines_f to calc_formula_signs</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_balance_source_lines_f"
                baseColumnNames="sign"
                constraintName="fk_calc_balance_source_lines_f_4"
                deferrable="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="calc_formula_signs"
                referencedColumnNames="code"
        />
    </changeSet>

    <changeSet id="calc-eug-1855" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating table: calc_balance_source_lines_f_tl</comment>
        <createTable tableName="calc_balance_source_lines_f_tl" schemaName="apps" remarks="Перевод для строк баланса энергоисточника">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="line_id" type="number" remarks="Идентификатор родительской записи">
                <constraints nullable="false"/>
            </column>

            <column name="lang" type="varchar(10)" remarks="язык">
                <constraints nullable="false"/>
            </column>

            <column name="name" type="varchar(100)" remarks="Наименование строки">
                <constraints nullable="false"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="calc-eug-1856" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating primary key for table: calc_balance_source_lines_f_tl</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_calc_balance_source_lines_f_tl"
                schemaName="apps"
                tableName="calc_balance_source_lines_f_tl"/>
    </changeSet>

    <changeSet id="calc-eug-1857" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating unique key for table: calc_balance_source_lines_f_tl</comment>
        <addUniqueConstraint
                columnNames="line_id, lang"
                constraintName="uk_calc_balance_source_lines_f_tl_1"
                schemaName="apps"
                tableName="calc_balance_source_lines_f_tl"/>
    </changeSet>

    <changeSet id="calc-eug-1858" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating sequence for table: calc_balance_source_lines_f_tl</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="calc_balance_source_lines_f_tl_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="calc-eug-1859" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>creating index for table: calc_balance_source_lines_f_tl</comment>
        <createIndex indexName="idx_calc_balance_source_lines_f_tl_1" schemaName="apps" tableName="calc_balance_source_lines_f_tl">
            <column name="line_id"  type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-1860" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_balance_source_lines_f_tl to calc_balance_source_lines_f</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_balance_source_lines_f_tl"
                baseColumnNames="line_id"
                constraintName="fk_calc_balance_source_lines_f_tl_1"
                deferrable="true"
                onDelete="CASCADE"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="calc_balance_source_lines_f"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-1861" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Adding column to table: calc_balance_reg_result_headers</comment>
        <addColumn schemaName="apps" tableName="calc_balance_reg_result_headers">
            <column name="data_type" type="varchar2(30)" remarks="Статус данных">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="calc-eug-1862" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_balance_reg_result_headers to calc_data_types</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_balance_reg_result_headers"
                baseColumnNames="data_type"
                constraintName="fk_calc_balance_source_headers_9"
                deferrable="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="calc_data_types"
                referencedColumnNames="code"
        />
    </changeSet>

    <changeSet id="calc-eug-1863" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_distribution_result_h to calc_data_types</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_distribution_result_h"
                baseColumnNames="calc_type"
                constraintName="fk_calc_distribution_result_h_6"
                deferrable="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="calc_data_types"
                referencedColumnNames="code"
        />
    </changeSet>

</databaseChangeLog>