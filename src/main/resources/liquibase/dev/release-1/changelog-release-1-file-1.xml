<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">

    <changeSet id="calc-eug-1" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: calc_formulas</comment>
        <createTable tableName="calc_formulas" schemaName="apps" remarks="Формулы">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="code" type="varchar(20)" remarks="Уникальный код формулы">
                <constraints nullable="true"/>
            </column>

            <column name="description" type="varchar(300)" remarks="Описание формулы">
                <constraints nullable="true"/>
            </column>

            <column name="text" type="varchar(3000)" remarks="Текст формулы">
                <constraints nullable="false"/>
            </column>

            <column name="metering_point_id" type="number" remarks="Ид. точки учёта">
                <constraints nullable="false"/>
            </column>

            <column name="start_date" type="TIMESTAMP" remarks="Дата и время начала действия формулы">
                <constraints nullable="false"/>
            </column>

            <column name="end_date" type="TIMESTAMP" remarks="Дата и время окончания действия формулы">
                <constraints nullable="true"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="calc-eug-2" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: calc_formulas</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_calc_formulas"
                schemaName="apps"
                tableName="calc_formulas"/>
    </changeSet>

    <changeSet id="calc-eug-3" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: calc_formulas</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="calc_formulas_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="calc-eug-4" logicalFilePath="path-independent" author="eugene">
        <addUniqueConstraint
                columnNames="code"
                constraintName="un_calc_formulas_1"
                deferrable="true"
                initiallyDeferred="true"
                schemaName="apps"
                tableName="calc_formulas" />
    </changeSet>

    <changeSet id="calc-eug-5" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: calc_formulas</comment>
        <createTable tableName="calc_metering_point_params" schemaName="apps" remarks="Параметры, релевантные для точки учёта">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="metering_point_id" type="number" remarks="Ид. точки учёта">
                <constraints nullable="false"/>
            </column>

            <column name="parameter_id" type="number" remarks="Ид. параметра">
                <constraints nullable="false"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="calc-eug-6" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: calc_metering_point_params</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_calc_metering_point_params"
                schemaName="apps"
                tableName="calc_metering_point_params"/>
    </changeSet>

    <changeSet id="calc-eug-7" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: calc_metering_point_params</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="calc_metering_point_params_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="calc-eug-8" logicalFilePath="path-independent" author="eugene">
        <addUniqueConstraint
                columnNames="metering_point_id, parameter_id"
                constraintName="un_calc_metering_point_params_1"
                deferrable="true"
                initiallyDeferred="true"
                schemaName="apps"
                tableName="calc_metering_point_params" />
    </changeSet>

    <changeSet id="calc-eug-9" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_formulas to dict_metering_points</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_formulas"
                baseColumnNames="metering_point_id"
                constraintName="fk_calc_formulas_1"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_metering_points"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-10" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_metering_point_params to dict_metering_points</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_metering_point_params"
                baseColumnNames="metering_point_id"
                constraintName="fk_calc_metering_point_params_1"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_metering_points"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-11" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_metering_point_params to media_parameters</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_metering_point_params"
                baseColumnNames="parameter_id"
                constraintName="fk_calc_metering_point_params_2"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="media_parameters"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-12" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: media_period_time_values</comment>
        <createIndex indexName="idx_calc_formula_1"
                     schemaName="apps"
                     tableName="calc_formulas"
                     unique="false">
            <column name="metering_point_id" type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-13" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_metering_point_params</comment>
        <createIndex indexName="idx_calc_metering_point_params_1"
                     schemaName="apps"
                     tableName="calc_metering_point_params"
                     unique="false">
            <column name="metering_point_id" type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-14" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_metering_point_params</comment>
        <createIndex indexName="idx_calc_metering_point_params_2"
                     schemaName="apps"
                     tableName="calc_metering_point_params"
                     unique="false">
            <column name="parameter_id" type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-15" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>add Column into table: media_source_types</comment>
        <addColumn schemaName="apps" tableName="media_source_types">
            <column name="priority" type="number" remarks="Приоритет">
                <constraints nullable="true"/>
            </column>

            <column name="is_oper" type="number" remarks="Подходит для оперативного расчёта">
                <constraints nullable="true"/>
            </column>

            <column name="is_final" type="number" remarks="Подходит для окончательного расчёта">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="calc-eug-16" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: calc_priority_lines</comment>
        <createTable tableName="calc_priority_lines" schemaName="apps" remarks="Приоритеты использования - строки">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="priority_header_id" type="number" remarks="Ид. заголовка">
                <constraints nullable="false"/>
            </column>

            <column name="source_type_id" type="number" remarks="Ид. источника данных">
                <constraints nullable="false"/>
            </column>

            <column name="priority" type="number" remarks="Приоритет">
                <constraints nullable="false"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="calc-eug-17" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: calc_priority_lines</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="calc_priority_lines_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="calc-eug-18" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_priority_lines to media_source_types</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_priority_lines"
                baseColumnNames="source_type_id"
                constraintName="fk_calc_priority_lines_1"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="media_source_types"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-20" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_priority_lines</comment>
        <createIndex indexName="idx_calc_priority_lines_1" schemaName="apps" tableName="calc_priority_lines" unique="false">
            <column name="source_type_id" type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-22" logicalFilePath="path-independent" author="eugene" context="dev">
        <preConditions onFail="MARK_RAN" >
            <columnExists schemaName="apps" tableName="media_period_time_values" columnName="source_metering_point_code" />
        </preConditions>

        <comment>Dropping columns from table media_period_time_values</comment>
        <dropColumn schemaName="apps" tableName="media_period_time_values" columnName="source_metering_point_code" />
        <rollback/>
    </changeSet>

    <changeSet id="calc-eug-23" logicalFilePath="path-independent" author="eugene" context="dev">
        <preConditions onFail="MARK_RAN" >
            <columnExists schemaName="apps" tableName="media_period_time_values" columnName="source_param_code" />
        </preConditions>

        <comment>Dropping columns from table media_period_time_values</comment>
        <dropColumn schemaName="apps" tableName="media_period_time_values" columnName="source_param_code" />
        <rollback/>
    </changeSet>

    <changeSet id="calc-eug-24" logicalFilePath="path-independent" author="eugene" context="dev">
        <preConditions onFail="MARK_RAN" >
            <columnExists schemaName="apps" tableName="media_period_time_values" columnName="source_unit_code" />
        </preConditions>

        <comment>Dropping columns from table media_period_time_values</comment>
        <dropColumn schemaName="apps" tableName="media_period_time_values" columnName="source_unit_code" />
        <rollback/>
    </changeSet>

    <changeSet id="calc-eug-25" logicalFilePath="path-independent" author="eugene" context="dev">
        <preConditions onFail="MARK_RAN" >
            <columnExists schemaName="apps" tableName="media_at_time_values" columnName="source_metering_point_code" />
        </preConditions>

        <comment>Dropping columns from table media_at_time_values</comment>
        <dropColumn schemaName="apps" tableName="media_at_time_values" columnName="source_metering_point_code" />
        <rollback/>
    </changeSet>

    <changeSet id="calc-eug-26" logicalFilePath="path-independent" author="eugene" context="dev">
        <preConditions onFail="MARK_RAN" >
            <columnExists schemaName="apps" tableName="media_at_time_values" columnName="source_param_code" />
        </preConditions>

        <comment>Dropping columns from table media_at_time_values</comment>
        <dropColumn schemaName="apps" tableName="media_at_time_values" columnName="source_param_code" />
        <rollback/>
    </changeSet>

    <changeSet id="calc-eug-27" logicalFilePath="path-independent" author="eugene" context="dev">
        <preConditions onFail="MARK_RAN" >
            <columnExists schemaName="apps" tableName="media_at_time_values" columnName="source_unit_code" />
        </preConditions>

        <comment>Dropping columns from table media_at_time_values</comment>
        <dropColumn schemaName="apps" tableName="media_at_time_values" columnName="source_unit_code" />
        <rollback/>
    </changeSet>

    <changeSet id="calc-eug-28" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: calc_daily_sheet_headers</comment>
        <createTable tableName="calc_daily_sheet_headers" schemaName="apps" remarks="Заголовок суточной ведомости">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="org_id" type="number" remarks="Ид. филиала">
                <constraints nullable="false"/>
            </column>

            <column name="period_type" type="varchar(10)" remarks="Статус">
                <constraints nullable="false"/>
            </column>

            <column name="metering_date" type="TIMESTAMP" remarks="Дата и время, на которые производится ввод данных">
                <constraints nullable="false"/>
            </column>

            <column name="metering_data_source_id" type="number" remarks="Ид. филиала">
                <constraints nullable="false"/>
            </column>

            <column name="status" type="varchar(20)" remarks="Статус">
                <constraints nullable="false"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="calc-eug-29" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: calc_daily_sheet_headers</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_calc_daily_sheet_headers"
                schemaName="apps"
                tableName="calc_daily_sheet_headers"/>
    </changeSet>

    <changeSet id="calc-eug-30" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: calc_daily_sheet_headers</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="calc_daily_sheet_headers_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="calc-eug-31" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: calc_daily_sheet_lines</comment>
        <createTable tableName="calc_daily_sheet_lines" schemaName="apps" remarks="Строки суточной ведомости">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="daily_sheet_header_id" type="number" remarks="Ид. заголовка суточной ведомости">
                <constraints nullable="false"/>
            </column>

            <column name="metering_point_id" type="number" remarks="Ид. точки учёта">
                <constraints nullable="false"/>
            </column>

            <column name="meter_id" type="number" remarks="Ид. счётчика">
                <constraints nullable="true" />
            </column>

            <column name="param_id" type="number" remarks="Ид. параметра">
                <constraints nullable="true" />
            </column>

            <column name="source_type_id" type="number" remarks="Ид. параметра">
                <constraints nullable="true" />
            </column>

            <column name="start_val" type="number" remarks="Показания на начало периода">
                <constraints nullable="true" />
            </column>

            <column name="end_val" type="number" remarks="Показания на конец периода">
                <constraints nullable="true" />
            </column>

            <column name="val" type="number" remarks="Расход за период">
                <constraints nullable="true" />
            </column>

            <column name="under_count_val" type="number" remarks="Недучёт за период">
                <constraints nullable="true" />
            </column>

            <column name="is_oper" type="number" remarks="Расход за период">
                <constraints nullable="true" />
            </column>

            <column name="is_under_count" type="number" remarks="Расход за период">
                <constraints nullable="true" />
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="calc-eug-32" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: calc_daily_sheet_lines</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_calc_daily_sheet_lines"
                schemaName="apps"
                tableName="calc_daily_sheet_lines"/>
    </changeSet>

    <changeSet id="calc-eug-33" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: calc_daily_sheet_lines</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="calc_daily_sheet_lines_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="calc-eug-34" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_daily_sheet_lines to dict_metering_points</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_daily_sheet_lines"
                baseColumnNames="metering_point_id"
                constraintName="fk_calc_daily_sheet_lines_1"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_metering_points"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-35" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_daily_sheet_lines to dict_meters</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_daily_sheet_lines"
                baseColumnNames="meter_id"
                constraintName="fk_calc_daily_sheet_lines_2"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_meters"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-36" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_daily_sheet_lines to media_parameters</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_daily_sheet_lines"
                baseColumnNames="param_id"
                constraintName="fk_calc_daily_sheet_lines_3"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="media_parameters"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-37" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_daily_sheet_lines to media_source_types</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_daily_sheet_lines"
                baseColumnNames="source_type_id"
                constraintName="fk_calc_daily_sheet_lines_4"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="media_source_types"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-38" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_daily_sheet_headers to dict_organizations</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_daily_sheet_headers"
                baseColumnNames="org_id"
                constraintName="fk_calc_daily_sheet_headers_1"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_organizations"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-39" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: calc_daily_sheet_headers</comment>
        <createTable tableName="calc_metering_data_sources" schemaName="apps" remarks="Источники получения данных">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="description" type="varchar(300)" remarks="Описание источника данных">
                <constraints nullable="false"/>
            </column>

            <column name="contact_info" type="varchar(300)" remarks="Контактные данные источника данных">
                <constraints nullable="true"/>
            </column>

            <column name="org_id" type="number" remarks="Ид. филиала">
                <constraints nullable="false"/>
            </column>

            <column name="is_active" type="number" remarks="Активно/Неактивно">
                <constraints nullable="false"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="calc-eug-40" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: calc_metering_data_sources</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_calc_metering_data_sources"
                schemaName="apps"
                tableName="calc_metering_data_sources"/>
    </changeSet>

    <changeSet id="calc-eug-41" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: calc_metering_data_sources</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="calc_metering_data_sources_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="calc-eug-42" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_metering_data_sources to dict_organizations</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_metering_data_sources"
                baseColumnNames="org_id"
                constraintName="fk_calc_metering_data_sources_1"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_organizations"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-43" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_daily_sheet_headers to calc_metering_data_sources</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_daily_sheet_headers"
                baseColumnNames="metering_data_source_id"
                constraintName="fk_calc_daily_sheet_headers_2"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="calc_metering_data_sources"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-44" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: calc_daily_sheet_headers</comment>
        <createTable tableName="calc_metering_data_source_lines" schemaName="apps" remarks="Точки учёта, относящиеся к источникам данных">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="metering_data_source_id" type="number" remarks="Идентификатор источника получения данных">
                <constraints nullable="false"/>
            </column>

            <column name="metering_point_id" type="number" remarks="Идентификатор точки учёта">
                <constraints nullable="false"/>
            </column>

            <column name="order_num" type="number" remarks="Порядковый номер в списке">
                <constraints nullable="false"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="calc-eug-45" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_metering_data_source_lines to dict_metering_points</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_metering_data_source_lines"
                baseColumnNames="metering_point_id"
                constraintName="fk_calc_metering_data_source_lines_1"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_metering_points"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-46" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_metering_data_source_lines to dict_metering_points</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_metering_data_source_lines"
                baseColumnNames="metering_data_source_id"
                constraintName="fk_calc_metering_data_source_lines_2"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="calc_metering_data_sources"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-47" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_metering_data_source_lines</comment>
        <createIndex indexName="idx_calc_metering_data_source_lines_1"
                     schemaName="apps"
                     tableName="calc_metering_data_source_lines"
                     unique="false">
            <column name="metering_point_id" type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-48" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_metering_data_source_lines</comment>
        <createIndex indexName="idx_calc_metering_data_source_lines_2"
                     schemaName="apps"
                     tableName="calc_metering_data_source_lines"
                     unique="false">
            <column name="metering_data_source_id" type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-49" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_metering_data_sources</comment>
        <createIndex indexName="idx_calc_metering_data_sources_1"
                     schemaName="apps"
                     tableName="calc_metering_data_sources"
                     unique="false">
            <column name="org_id" type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-50" logicalFilePath="path-independent" author="eugene" context="dev">
        <addUniqueConstraint
                columnNames="metering_data_source_id, metering_point_id"
                constraintName="un_calc_metering_data_source_lines_1"
                deferrable="true"
                initiallyDeferred="true"
                schemaName="apps"
                tableName="calc_metering_data_source_lines"/>
    </changeSet>

    <changeSet id="calc-eug-51" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: calc_priority_lines</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_calc_priority_lines"
                schemaName="apps"
                tableName="calc_priority_lines"/>
    </changeSet>


    <changeSet id="calc-eug-52" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: calc_priority_headers</comment>
        <createTable tableName="calc_priority_headers" schemaName="apps" remarks="Приоритеты использования данных - заголовки">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="description" type="varchar(300)" remarks="Описание">
                <constraints nullable="false"/>
            </column>

            <column name="start_date" type="TIMESTAMP" remarks="Дата и время начала действия приоритета">
                <constraints nullable="false"/>
            </column>

            <column name="end_date" type="TIMESTAMP" remarks="Дата и время окончания действия приоритета">
                <constraints nullable="true"/>
            </column>

            <column name="is_active" type="number" remarks="Активно/Неактивно">
                <constraints nullable="false"/>
            </column>

            <column name="org_id" type="number" remarks="Ид. филиала">
                <constraints nullable="false"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="calc-eug-53" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: calc_priority_headers</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_calc_priority_headers"
                schemaName="apps"
                tableName="calc_priority_headers"/>
    </changeSet>

    <changeSet id="calc-eug-54" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: calc_priority_headers</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="calc_priority_headers_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="calc-eug-55" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_priority_lines to calc_priority_headers</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_priority_lines"
                baseColumnNames="priority_header_id"
                constraintName="fk_calc_priority_lines_2"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="calc_priority_headers"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-56" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_priority_lines</comment>
        <createIndex indexName="idx_calc_priority_lines_2" schemaName="apps" tableName="calc_priority_lines" unique="false">
            <column name="priority_header_id" type="number"/>
        </createIndex>
    </changeSet>


    <changeSet id="calc-eug-57" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: calc_priority_metering_points</comment>
        <createTable tableName="calc_priority_metering_points" schemaName="apps" remarks="Приоритеты использования данных - точки учёта">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="priority_header_id" type="number" remarks="Ид. заголовка">
                <constraints nullable="false"/>
            </column>

            <column name="metering_point_id" type="number" remarks="Ид. точки учёта">
                <constraints nullable="false"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="calc-eug-58" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: calc_priority_metering_points</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_calc_priority_metering_points"
                schemaName="apps"
                tableName="calc_priority_metering_points"/>
    </changeSet>

    <changeSet id="calc-eug-59" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: calc_priority_metering_points</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="calc_priority_metering_points_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="calc-eug-60" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_priority_metering_points to calc_priority_headers</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_priority_metering_points"
                baseColumnNames="priority_header_id"
                constraintName="fk_calc_priority_metering_points_1"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="calc_priority_headers"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-61" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_priority_metering_points</comment>
        <createIndex indexName="idx_calc_priority_metering_points_1" schemaName="apps" tableName="calc_priority_metering_points" unique="false">
            <column name="priority_header_id" type="number"/>
        </createIndex>
    </changeSet>

    <changeSet id="calc-eug-62" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: calc_priority_headers to dict_organizations</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_priority_headers"
                baseColumnNames="org_id"
                constraintName="fk_calc_priority_headers_1"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_organizations"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="calc-eug-63" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating index: calc_priority_headers</comment>
        <createIndex indexName="idx_calc_priority_headers_1" schemaName="apps" tableName="calc_priority_headers" unique="false">
            <column name="org_id" type="number"/>
        </createIndex>
    </changeSet>
</databaseChangeLog>
