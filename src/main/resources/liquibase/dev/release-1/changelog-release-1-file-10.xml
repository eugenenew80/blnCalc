<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">


    <changeSet id="calc-rus-308" logicalFilePath="path-independent" author="ruslan" context="dev">
        <comment>rename column calc_daily_sheet_headers</comment>
        <renameColumn columnDataType="varchar2(20)"
                      newColumnName="data_status"
                      oldColumnName="status"
                      remarks="Статус данных"
                      schemaName="apps"
                      tableName="calc_daily_sheet_headers"/>
    </changeSet>

    <changeSet id="calc-rus-309" logicalFilePath="path-independent" author="ruslan" context="dev">
        <comment>modify datatype column calc_daily_sheet_headers</comment>
        <modifyDataType columnName="data_status"
                        newDataType="varchar2(20)"
                        schemaName="apps"
                        tableName="calc_daily_sheet_headers"/>
    </changeSet>

    <changeSet id="calc-rus-310" logicalFilePath="path-independent" author="ruslan" context="dev">
        <comment>Creating foreign constraint: calc_daily_sheet_headers to calc_data_statuses</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_daily_sheet_headers"
                baseColumnNames="data_status"
                constraintName="fk_calc_daily_sheet_headers_4"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="calc_data_statuses"
                referencedColumnNames="code"
        />
    </changeSet>

    <changeSet id="calc-rus-311" logicalFilePath="path-independent" author="ruslan" context="dev">
        <comment>drop not null constraint calc_daily_sheet_headers.data_status</comment>
        <dropNotNullConstraint columnDataType="varchar2(10)"
                               columnName="data_status"
                               schemaName="apps"
                               tableName="calc_daily_sheet_headers"/>
        <rollback/>
    </changeSet>

    <changeSet id="calc-rus-312" logicalFilePath="path-independent" author="ruslan" context="dev">
        <comment>drop not null constraint calc_asp1_lines_tl.name</comment>
        <dropNotNullConstraint columnDataType="varchar2(500)"
                               columnName="name"
                               schemaName="apps"
                               tableName="calc_asp1_lines_tl"/>
        <rollback/>
    </changeSet>

    <changeSet id="calc-rus-313" logicalFilePath="path-independent" author="ruslan" context="dev">
        <comment>change default value calc_formula_var_det</comment>
        <addDefaultValue columnDataType="varchar2"
                         columnName="param_type"
                         defaultValue="PT"
                         schemaName="apps"
                         tableName="calc_formula_var_det"/>
    </changeSet>

    <changeSet id="calc-rus-314" logicalFilePath="path-independent" author="ruslan" context="dev">
        <comment>drop column calc_signatories</comment>
        <dropColumn columnName="doc_type_id"
                    schemaName="apps"
                    tableName="calc_balance_units"/>
    </changeSet>

    <changeSet id="calc-rus-315" logicalFilePath="path-independent" author="ruslan" context="dev">
        <comment>add column calc_signatories</comment>
        <addColumn schemaName="apps"
                   tableName="calc_balance_units">
            <column name="doc_type" type="varchar2(30)"/>
        </addColumn>
    </changeSet>

    <changeSet id="calc-rus-316" logicalFilePath="path-independent" author="ruslan" context="dev">
        <comment>Creating foreign constraint: calc_balance_units to dm_regulations</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="calc_balance_units"
                baseColumnNames="doc_type"
                constraintName="fk_calc_balance_units_4"
                deferrable="true"
                initiallyDeferred="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dm_regulations"
                referencedColumnNames="code"
        />
    </changeSet>
</databaseChangeLog>
